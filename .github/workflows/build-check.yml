# 构建检查工作流
# 每次推送或 PR 时自动检查代码是否能正常构建
# 这是一种 CI (持续集成) 的实践，确保每次代码变更都不会破坏构建

name: Build Check

# 触发条件：
# - 任何分支的 push（代码推送）
# - 任何 PR（拉取请求）
on:
  push:
    branches: ['*']
  pull_request:
    branches: ['*']

jobs:
  # 前端构建检查
  build-frontend:
    name: Build Frontend
    runs-on: ubuntu-latest

    steps:
      # 第一步：检出代码
      # actions/checkout 是 GitHub 官方提供的 action，用于将仓库代码下载到运行环境
      - name: Checkout code
        uses: actions/checkout@v4

      # 第二步：设置 Node.js 环境
      # actions/setup-node 用于安装指定版本的 Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'
          cache-dependency-path: 'pnpm-lock.yaml'

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      # 第三步：安装依赖
      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      # 第四步：构建前端
      - name: Build frontend
        run: pnpm run build

      # 第五步：检查 Electron 主进程语法
      - name: Check Electron main process
        run: node --check electron/main.js

  # 后端检查（Go 测试与编译）
  check-backend:
    name: Check Backend
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version-file: 'backend/go.mod'
          cache-dependency-path: 'backend/go.sum'

      - name: Download Go modules
        run: |
          cd backend
          go mod download

      - name: Run backend tests
        run: |
          cd backend
          go test ./...

      - name: Check backend build
        run: |
          cd backend
          go build ./...
